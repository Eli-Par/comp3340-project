<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Head Partial -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Funnel+Sans:ital,wght@0,300..800;1,300..800&display=swap"
        rel="stylesheet">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="global.css">
    <link rel="stylesheet" href="gallery.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined">
    <title>Gallery | Travel Tipia</title>
    <meta name="description" content="View photos from travel tipia's various travel tips all in one convenient place">
    <meta name="keywords" content="gallery, travel, explore, adventure, community, tip, hub">

</head>

<body>

    <!-- Image overlay that will go over all items when set visible, initially hidden -->
    <div id="image-overlay" class="image-overlay" style="display: none;">
        <img src="">
    </div>

    <!-- Header Partial -->
    <header>
        <a class="title-container" href="index.php">
            <img src="TravelTipiaLogo.svg" style="width: 30px; height: 30px;">
            <h1 class="title desktop-only">Travel Tipia</h1>
        </a>
        <nav class="nav-bar">
            <a class="nav-link hover-underline" href="index.php">Home</a>
        </nav>
    </header>

    <!-- gallery with section for gallery images (filled using js) -->
    <main>
        <h1 style="margin-bottom: 10px;">Gallery</h1>
        <div id="gallery" class="gallery-grid"></div>
    </main>

    <!-- Footer Partial -->
    <footer>
        <p>&copy; 2025 Travel Tipia. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            //When image in gallery is clicked open popup
            document.getElementById('gallery').addEventListener('click', (e) => {
                if(e.target.tagName === 'IMG') {
                    e.stopPropagation();

                    //Find image overlay image and set the img
                    const overlayImg = document.querySelector('.image-overlay > img');
                    overlayImg?.setAttribute('src', e.target.src);
                    overlayImg?.setAttribute('alt', e.target.alt);

                    //Set the overlay visible
                    const overlay = document.querySelector('.image-overlay');
                    overlay.style.display = 'flex';
                }
            });

            //When overlay background clicked hide overlay. Dont do so when clicking the image itself
            document.getElementById('image-overlay').addEventListener('click', (e) => {
                if (e.target.tagName !== 'IMG') {
                    e.stopPropagation();
                    const overlay = document.querySelector('.image-overlay');
                    overlay.style.display = 'none';
                }
            });

            document.addEventListener('keydown', (e) => {
                if(e.code === 'Escape') {
                    const overlay = document.querySelector('.image-overlay');
                    if(overlay) overlay.style.display = 'none';
                }
            })

            //Fetch list of images in gallery directory
            fetch('../private/gallery_api.php')
            .then(res => res.json())
            .then(data => {
                const files = data.files;

                const galleryContainer = document.getElementById("gallery");

                //iterate over file paths received and setup the gallery items
                Object.values(files).forEach((f) => {
                    //If an image type, append an img tag in the grid
                    if(f.endsWith('.png') || f.endsWith('.jpg') || f.endsWith('.jpeg') || f.endsWith('.webp')) {
                        const image = document.createElement('img');
                        image.classList.add('content');
                        image.setAttribute('src', `gallery/${f}`);
                        image.setAttribute('alt', f);

                        galleryContainer.appendChild(image);
                    }
                    else if(f.endsWith('.mp4')) { // if a video append a video into the grid
                        const video = document.createElement('video');
                        video.classList.add('content', 'video');
                        video.setAttribute('src', `gallery/${f}`);
                        video.setAttribute('controls', '');

                        galleryContainer.appendChild(video);
                    }
                });
            })
        });
    </script>
</body>

</html>